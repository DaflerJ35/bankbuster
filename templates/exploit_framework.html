{% extends "base.html" %}

{% block title %}Exploit Framework - Red Team Platform{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>
                <i class="fas fa-code text-danger me-2"></i>
                Exploit Framework
            </h2>
            <p class="text-muted mb-0">Controlled exploitation for security testing</p>
        </div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item active">Exploit Framework</li>
            </ol>
        </nav>
    </div>
    
    <!-- Security Warning -->
    <div class="alert alert-danger mb-4" role="alert">
        <div class="d-flex">
            <div class="flex-shrink-0">
                <i class="fas fa-exclamation-triangle fa-2x"></i>
            </div>
            <div class="flex-grow-1 ms-3">
                <h5 class="alert-heading">
                    <i class="fas fa-shield-alt me-2"></i> Authorized Use Only
                </h5>
                <p class="mb-2">
                    This exploit framework is designed for authorized penetration testing only. 
                    All exploitation attempts are logged and monitored.
                </p>
                <ul class="mb-0">
                    <li>Only target systems you own or have explicit written permission to test</li>
                    <li>All activities are encrypted and logged for audit purposes</li>
                    <li>Safety measures prevent accidental damage to target systems</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-rocket me-2"></i> Exploit Execution
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.execute_exploit') }}">
                        <div class="mb-3">
                            <label for="exploit_name" class="form-label">Exploit Module</label>
                            <select class="form-select" id="exploit_name" name="exploit_name" required>
                                <option value="">Select an exploit module...</option>
                                {% for exploit_id, description in available_exploits.items() %}
                                <option value="{{ exploit_id }}">{{ description }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="target" class="form-label">Target System</label>
                            <input type="text" class="form-control" id="target" name="target" 
                                   placeholder="e.g., 192.168.1.100 or target.example.com" required>
                            <div class="form-text">
                                IP address or hostname of the target system
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-header">
                                        <h6 class="mb-0">Security Options</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="use_anonymity" 
                                                   name="use_anonymity" checked>
                                            <label class="form-check-label" for="use_anonymity">
                                                <i class="fas fa-user-secret me-1"></i>
                                                Enable Anonymity (Tor)
                                            </label>
                                        </div>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="safe_mode" checked disabled>
                                            <label class="form-check-label" for="safe_mode">
                                                <i class="fas fa-shield-alt me-1"></i>
                                                Safe Mode (Always On)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="exploit-details" class="card bg-light">
                                    <div class="card-header">
                                        <h6 class="mb-0">Exploit Details</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted small">Select an exploit to see details</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
                                    <i class="fas fa-times me-1"></i> Cancel
                                </a>
                                <button type="submit" class="btn btn-danger" onclick="return confirmExploit()">
                                    <i class="fas fa-play me-1"></i> Execute Exploit
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- Available Exploits -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-list me-1"></i> Available Exploit Modules
                    </h6>
                </div>
                <div class="card-body">
                    {% for exploit_id, description in available_exploits.items() %}
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-code text-danger me-2"></i>
                        <div>
                            <strong>{{ exploit_id.replace('_', ' ')|title }}</strong>
                            <br>
                            <small class="text-muted">{{ description }}</small>
                        </div>
                    </div>
                    {% if not loop.last %}<hr class="my-2">{% endif %}
                    {% endfor %}
                </div>
            </div>
            
            <!-- Safety Features -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-shield-alt me-1"></i> Safety Features
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Authorization verification</small>
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Rate limiting protection</small>
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Encrypted audit logging</small>
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Controlled payload execution</small>
                    </div>
                    <div class="mb-0">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <small>Automatic cleanup routines</small>
                    </div>
                </div>
            </div>
            
            <!-- Legal Notice -->
            <div class="alert alert-info" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Legal Notice:</strong> All exploit activities must comply with applicable laws and regulations. Unauthorized access is prohibited.
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Exploit details mapping
const exploitDetails = {
    'ssh_bruteforce': {
        description: 'Tests SSH services for weak authentication credentials',
        risk_level: 'Medium',
        detection_risk: 'High',
        requirements: 'SSH service (port 22) accessible'
    },
    'web_sql_injection': {
        description: 'Tests web applications for SQL injection vulnerabilities',
        risk_level: 'High', 
        detection_risk: 'Medium',
        requirements: 'Web application with database backend'
    },
    'web_xss': {
        description: 'Tests web applications for Cross-Site Scripting vulnerabilities',
        risk_level: 'Medium',
        detection_risk: 'Low',
        requirements: 'Web application with user input fields'
    },
    'ftp_anonymous': {
        description: 'Tests FTP services for anonymous access',
        risk_level: 'Low',
        detection_risk: 'Low',
        requirements: 'FTP service (port 21) accessible'
    },
    'weak_passwords': {
        description: 'Tests various services for weak authentication',
        risk_level: 'Medium',
        detection_risk: 'High',
        requirements: 'Services with authentication mechanisms'
    },
    'directory_traversal': {
        description: 'Tests web applications for directory traversal vulnerabilities',
        risk_level: 'High',
        detection_risk: 'Medium',
        requirements: 'Web application with file access functionality'
    }
};

document.getElementById('exploit_name').addEventListener('change', function() {
    const exploitId = this.value;
    const detailsCard = document.getElementById('exploit-details');
    
    if (exploitId && exploitDetails[exploitId]) {
        const details = exploitDetails[exploitId];
        const riskColor = details.risk_level === 'High' ? 'danger' : 
                         details.risk_level === 'Medium' ? 'warning' : 'success';
        const detectionColor = details.detection_risk === 'High' ? 'danger' : 
                              details.detection_risk === 'Medium' ? 'warning' : 'success';
        
        detailsCard.innerHTML = `
            <div class="card-header">
                <h6 class="mb-0">Exploit Details</h6>
            </div>
            <div class="card-body">
                <p class="small mb-2">${details.description}</p>
                <div class="mb-1">
                    <strong>Risk Level:</strong> 
                    <span class="badge bg-${riskColor}">${details.risk_level}</span>
                </div>
                <div class="mb-1">
                    <strong>Detection Risk:</strong> 
                    <span class="badge bg-${detectionColor}">${details.detection_risk}</span>
                </div>
                <div class="mb-0">
                    <strong>Requirements:</strong>
                    <br><small class="text-muted">${details.requirements}</small>
                </div>
            </div>
        `;
    } else {
        detailsCard.innerHTML = `
            <div class="card-header">
                <h6 class="mb-0">Exploit Details</h6>
            </div>
            <div class="card-body">
                <p class="text-muted small">Select an exploit to see details</p>
            </div>
        `;
    }
});

function confirmExploit() {
    const exploitName = document.getElementById('exploit_name').value;
    const target = document.getElementById('target').value;
    
    if (!exploitName || !target) {
        alert('Please select an exploit and target before proceeding.');
        return false;
    }
    
    const confirmation = confirm(
        `WARNING: You are about to execute the "${exploitName}" exploit against "${target}".\n\n` +
        `This action will be logged and monitored. Only proceed if you have explicit authorization ` +
        `to test this target system.\n\nDo you want to continue?`
    );
    
    return confirmation;
}

// Target validation
document.getElementById('target').addEventListener('blur', function() {
    const target = this.value.trim();
    if (target && !isValidTarget(target)) {
        alert('Please enter a valid IP address or hostname.');
        this.focus();
    }
});

function isValidTarget(target) {
    const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
    const hostnameRegex = /^[a-zA-Z0-9]([a-zA-Z0-9\-\.]*[a-zA-Z0-9])?$/;
    return ipRegex.test(target) || hostnameRegex.test(target);
}
</script>
{% endblock %}
